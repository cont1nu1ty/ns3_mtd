# **软件需求规格说明（SRS）**  
**项目名称**：面向代理切换型移动目标防御的用户网络性能测量平台（真实/仿真）  
**版本**：1.0  
**日期**：2025年X月X日  

---

## 1. 产品目的（核心声明）

构建标准化、可扩展的代理切换型移动目标防御（MTD）性能测量平台，支持真实网络与NS-3仿真环境，实现：

- **防御算法量化评估**：提供多维度性能指标（可用性、延迟、切换代价、攻击阻断率）  
- **攻防闭环验证**：支持动态攻击流量根据防御动作实时调整（如洗牌、分域迁移）  
- **可复现实验**：导出标准化日志，支持仿真→真实网络环境迁移复现  
- **模块化测试框架**：解耦算法实现与参数配置，支持快速策略对比实验  

---

## 2. 产品概览（宏观蓝图）

| 维度         | 说明                                                                 |
|--------------|----------------------------------------------------------------------|
| **目标用户群** | DDoS防御研究者、学术实验室、网络攻防工程团队         |
| **运行环境**   | **仿真环境**：NS-3 + Python/ML扩展模块<br>**真实环境**：Linux服务器集群 + NS3 |
| **关键依赖**   | NS-3仿真器、Python（scikit-learn/Pandas）、攻击数据集（如CAIDA） |
| **核心约束**   | 攻防闭环稳定性（避免振荡）、NS-3动态拓扑更新成本、会话中断控制      |

---

## 3. 功能需求（能力与限制）// 这里的函数具体名称和参数可以根据实际场景进行修改。
### 3.1 攻击感知层

| 子模块         | 功能                                                                 | 限制                              |
|----------------|----------------------------------------------------------------------|-----------------------------------|
| **代理级感知** | 基于阈值规则（流量速率、连接突增）实时检测；支持阈值动态调整接口     | 误报率高，仅适用于快速初筛        |
| **代理间感知** | 横向流量一致性比较（聚类/线性回归）；输出分布图与异常报告           | 依赖"同类代理行为相似"假设         |
| **全局感知**   | 多维特征融合ML模型（支持外部数据集）；输出攻击标签与预测日志         | 延迟高（>1s），不可用于实时洗牌    |

### 3.2 评分与风险分级//用户自定义，此处仅参考

- **核心公式**：`score = α·rate + β·anomaly + γ·persistence + δ·feedback`  
- **能力**：  
  - 时序衰减：`score_t+1 = score_t * exp(-λΔt) + new_obs_weight`  
  - 风险等级映射（Low/Medium/High）驱动洗牌频率  
- **限制**：参数敏感（α/β/γ/δ需调优）；自适应阈值可能引发振荡  

### 3.3 分域管理（DomainManager）//预留好接口，然后用户去输入某一种分级分域算法

本模块负责用户与代理节点的逻辑分组（域）的创建、调整和维护，是实现负载均衡和攻击面分散的核心。

**功能描述：**

- **用户-域关联查询**：系统应能实时查询并确定任意用户当前所属的洗牌域  
- **跨域用户迁移**：系统应支持将指定用户从一个洗牌域迁移到另一个洗牌域，并记录迁移事件  
- **动态域拆分**：系统应能监控域负载（如代理数、带宽、连接数），并在负载超过预设高阈值时自动触发域的拆分操作，以维持域内性能  
- **动态域合并**：系统应能识别持续低负载的洗牌域，并在负载低于预设低阈值时将其与相邻域合并，以优化资源利用率  
- **分域策略支持**：系统应支持多种分域策略，包括：  
  - **初始静态分域**：基于一致性哈希算法进行初始用户分配  
  - **动态聚类分域**：基于用户流量特征（如请求速率、地域、历史评分）进行聚类，实现更精细的域划分  
  - **负载感知迁移**：在低活动时段批量迁移用户，以实现各域间的负载均衡，同时最小化迁移成本  

**限制：**

- 频繁的域变更（拆分/合并/迁移）可能导致用户会话中断，需严格控制操作频率  
- 在NS-3仿真环境中，动态拓扑更新成本较高，需通过逻辑映射而非物理节点变更来降低开销  

### 3.4 洗牌隔离（ShuffleController）//用户自定义，此处仅参考

- **多策略支持**：随机、评分驱动、分组轮回、攻击者回避  
- **动态调频**：`f_domain = clamp(f_base * (1 + k·risk_factor), f_min, f_max)`  
- **会话亲和**：长连接（TCP）软切换（镜像双写）+ 批处理迁移  

### 3.5 动态攻击模拟（Attacker）

- **能力**：订阅防御事件（洗牌/迁移），实时调整攻击参数（速率、目标）  
- **限制**：闭环过强需引入冷却窗口防振荡  

### 3.6 可视化与导出

- **导出内容**：流量日志（JSON/CSV）、域状态、洗牌事件、攻击参数  
- **可复现性**：记录拓扑、随机种子、时序事件，支持真实平台重放  

---

## 4. 系统设计（模块功能实现映射）

本章节详细说明实现上述功能需求所规划的系统模块及其核心函数，作为从需求到具体实现的桥梁。模块顺序与功能需求章节保持一致。

### 4.1 攻击感知层

负责从不同层级检测异常流量，为风险评分提供输入。

- **LocalDetector（代理级感知）**
  - `SetThresholds(th)`: 设置流量速率、连接数等检测阈值
  - `GetStats(agentID)`: 获取指定代理的实时流量统计表
- **CrossAgentDetector（代理间感知）**
  - `SetFeatures(feat)`: 自定义用于横向比较的流量特征
  - `GetDistribution()`: 获取代理间流量分布图与异常报告
- **GlobalDetector（全局感知）**
  - `LoadDataset(path)`: 加载外部攻击数据集用于模型训练
  - `GetPrediction()`: 获取全局ML模型的分类报告和攻击预测日志

### 4.2 评分与风险分级

根据感知层输出，计算用户风险评分并划分等级。

- **ScoreManager**
  - `UpdateScore(userID, obs)`: 根据新的观测值（obs）更新用户评分，实现时序衰减和反馈加权
  - `GetRiskLevel(userID)`: 获取用户当前的风险等级（Low/Medium/High）

### 4.3 分域管理模块

实现域的创建、调整和用户迁移策略。

- **DomainManager**
  - `GetDomain(userID)`: 实现【用户-域关联查询】功能
  - `MoveUser(userID, newDomain)`: 实现【跨域用户迁移】功能
  - `SplitDomain(domainID)`: 实现【动态域拆分】功能
  - `MergeDomain(domainIDA，domainIDB)`: 实现【动态域合并】功能
- **MetricsAPI**
  - `GetDomainMetrics(domainID)`: 获取指定域的性能指标（吞吐、延迟、连接数、评分分布），为负载均衡策略提供数据支持

### 4.4 洗牌隔离模块//考虑用户策略不同，其洗牌也可能有所区别，这里应当为用户提供可扩展、自定义

根据风险等级和策略，执行用户与代理节点的重映射。

- **ShuffleController**
  - `TriggerShuffle(domainID, mode)`: 按指定策略（随机、评分驱动等）触发域内洗牌
  - `SetFrequency(domainID, f)`: 设置域的洗牌基础频率
- **TrafficDataAPI**
  - `GetTrafficData(domainID)`: 返回指定域的实时流量信息，用于策略评估

### 4.5 动态攻击模拟模块

模拟能根据防御行为自适应调整的智能攻击者。

- **AttackGenerator**
  - `Generate(params)`: 根据参数生成初始攻击流量
  - `Update(params)`: 实时更新攻击参数（速率、目标等）
  - `SubscribeDefenseEvents(cb)`: 订阅防御系统事件（如洗牌、迁移），实现闭环联动

### 4.6 可视化与导出模块

提供实验数据的可视化展示和标准化导出。

- **ExportAPI**
  - `ExportExperimentSnapshot(path)`: 导出包含拓扑、配置、随机种子等完整实验快照
  - `ExportTrafficTrace(path)`: 导出流量日志、攻击事件、洗牌事件等时序数据
  - `ExportDomainState(path)`: 导出域状态和用户分布信息

### 4.7 事件总线

解耦各模块间的通信，实现事件驱动架构。

- **EventBus**
  - `Publish(event)`: 发布事件（如洗牌事件、迁移事件）
  - `Subscribe(eventType, callback)`: 订阅特定类型的事件并注册回调函数

---

## 5. 外部接口说明

### 5.1 API协议

- **协议**：RESTful over HTTP（JSON格式）  
- **认证**：Token-based（防御模块）与密钥（攻击模块）  

### 5.2 关键接口

| 模块         | 接口                                | 输入/输出示例                              |
|--------------|-------------------------------------|--------------------------------------------|
| **感知层**   | `LocalDetector::SetThresholds(th)`  | 输入：`{"rate":1000, "conn":50}`           |
| **评分管理** | `ScoreManager::UpdateScore(userID, obs)` | 输入：`{"user123": {"rate":1.2, "anomaly":0.8}}` |
| **洗牌控制** | `TriggerShuffle(domainID, mode)`    | 输入：`{"domain2": "risk_based"}`         |
| **导出**     | `ExportExperimentSnapshot(path)`    | 输出：`experiment_2025.json`（含拓扑/日志）|

---

## 6. 设计约束

- **技术栈**：NS-3（仿真）、Python（ML/控制）、C++（核心模块）  
- **振荡控制**：攻击动作冷却时间≥10s；评分反馈衰减系数δ≤0.2  
- **迁移成本**：单次迁移重建连接数≤100；低峰时段（00:00-04:00）批量执行  

---

## 7. 验收准则

1. **防御算法评估**：输出对比报告（攻击阻断率≥90%、切换延迟≤200ms）  
2. **可复现性**：导出日志在真实平台重放误差≤5%  
3. **闭环稳定性**：攻防事件振荡次数≤3次/小时  
4. **扩展性验证**：支持动态加载新洗牌策略插件（<5分钟部署）  

---

## 8. 附录：术语表

| 术语               | 定义                                                                 |
|--------------------|----------------------------------------------------------------------|
| **洗牌（Shuffle）** | 动态重映射用户与代理节点，扰乱攻击面                                 |
| **域（Domain）**   | 逻辑分组，包含一组代理节点和用户                                     |
| **会话亲和**       | 长连接迁移时保持会话连续性的机制                                     |
